<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="{{ url_for('static', filename='patient_styles.css') }}">
        <title>Patient Portal - Health Dashboard</title>
    </head>
    <body>
        <header class="navbar">
            <div class="logo">CuraCloud</div>
            <div class="nav-buttons">
                <div class="right-header">
                    <div class="profile-icon"> 
                        <img id="admin-profile-icon" src="{{ url_for('static', filename='images/woman-patient.png') }}" alt="admin profile icon">
                    </div>
                    <a href="{{ url_for('auth.logout') }}">
                        <button class="logout-btn">Logout</button>
                    </a>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="side-menu">
                <ul>
                    <li><a href="{{ url_for('patient.patient_home') }}">Home</a></li>
                    <li><a href="{{ url_for('patient.appointments') }}">Appointments</a></li>
                    <li><a href="{{ url_for('patient.prescriptions') }}">Prescriptions</a></li>
                    <li><a href="{{ url_for('patient.billing') }}">Billing & Payments</a></li>
                    <li><a href="{{ url_for('patient.lab_results') }}">Lab Results</a></li>
                    <li><a href="{{ url_for('patient.patient_messages') }}">Messages</a></li>
                    <li><a href="{{ url_for('patient.patient_info') }}" class="active">Health Dashboard</a></li>
                </ul>
            </div>

            <div class="content">
                <div class="health-header">
                    <div class="patient-profile">
                        <div class="patient-avatar">ðŸ‘¤</div>
                        <div class="patient-info">
                            <h1>Welcome {{ patient_name }}</h1>
                            <div class="patient-meta">
                                <span class="meta-tag">Age: {{ patient.age }}</span>
                                <span class="meta-tag">{{ patient.gender.value }}</span>
                                <span class="meta-tag">{{ patient.race.value if patient.race else 'N/A' }}</span>
                                <span class="meta-tag">Patient ID: {{ patient.patient_code }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-container">
                    <div class="dashboard-vertical">
                        <div class="health-card">
                            <div class="card-header">
                                <div class="card-icon">ðŸ’Š</div>
                                <h3>Active Prescriptions</h3>
                            </div>
                            {% if patient.prescriptions %}
                                {% for prescription in patient.prescriptions %}
                                <div class="prescription-item">
                                    <div class="med-name">
                                        {{ prescription.medication_name }}
                                        <span class="status-badge status-active">Active</span>
                                    </div>
                                    <div class="med-details">{{ prescription.dosage }} - {{ prescription.frequency }}</div>
                                    <div class="med-notes">{{ prescription.instructions if prescription.instructions else 'Take as directed by your physician.' }}</div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="prescription-item">
                                    <div class="med-name">
                                        No active prescriptions
                                    </div>
                                </div>
                            {% endif %}
                            <div style="margin-top: 20px;">
                                <button class="glow-btn" onclick="requestRefill()">Request Refill</button>
                            </div>
                        </div>

                        <div class="health-card">
                            <div class="card-header">
                                <div class="card-icon">ðŸ‘¤</div>
                                <h3>Personal Details</h3>
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-header">Patient ID</div>
                                    <div class="info-value">{{ patient.patient_code }}</div>
                                </div>
                                
                                <div class="info-item">
                                    <div class="info-header">Date of Birth</div>
                                    <div class="info-value">
                                        {{ patient.dob.strftime('%m/%d/%Y') }}
                                    </div>
                                </div>

                                <div class="info-item">
                                    <div class="info-header">Age</div>
                                    <div class="info-value">
                                        {{ patient.age }} years
                                    </div>
                                </div>

                                <div class="info-item">
                                    <div class="info-header">Gender</div>
                                    <div class="info-value">
                                        {{ patient.gender.value }}
                                    </div>
                                </div>

                                <div class="info-item">
                                    <div class="info-header">Marital Status</div>
                                    <div class="info-value">
                                        {{ patient.marriage_status.value if patient.marriage_status else 'N/A' }}
                                    </div>
                                </div>

                                <div class="info-item">
                                    <div class="info-header">Race/Ethnicity</div>
                                    <div class="info-value">
                                        {{ patient.race.value if patient.race else 'N/A' }}
                                    </div>
                                </div>

                                <div class="info-item">
                                    <div class="info-header">Height</div>
                                    <div class="info-value">
                                        {{ patient.height }} cm
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="health-card">
                            <div class="card-header">
                                <div class="card-icon">ðŸ“ž</div>
                                <h3>Contact Information</h3>
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-header">Phone Number</div>
                                    <div class="info-value">
                                        {{ patient.phone_number if patient.phone_number else 'N/A' }}
                                    </div>
                                </div>

                                <div class="info-item">
                                    <div class="info-header">Email Address</div>
                                    <div class="info-value">
                                        {{ patient.email if patient.email else 'N/A' }}
                                    </div>
                                </div>

                                <div class="info-item">
                                    <div class="info-header">Home Address</div>
                                    <div class="info-value">
                                        {{ patient.address }}
                                    </div>
                                </div>

                                <div class="info-item">
                                    <div class="info-header">Primary Doctor</div>
                                    <div class="info-value">
                                        {% if patient.doctor %}
                                            Dr. {{ patient.doctor.first_name }} {{ patient.doctor.last_name }}
                                        {% else %}
                                            Not assigned
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 20px;">
                                <button class="glow-btn" onclick="updateContactInfo()">Update Contact Info</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function requestRefill() {
                alert('Redirecting to prescription refill page...');
                window.location.href = "{{ url_for('patient.prescriptions') }}";
            }

            function updateContactInfo() {
                alert('This feature would open a form to update contact information.');
            }

            document.addEventListener('DOMContentLoaded', function() {
                console.log('Patient info page loaded');
            });
        </script>
    </body>
</html>