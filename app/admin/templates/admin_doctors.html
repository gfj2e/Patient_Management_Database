<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='patient_styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin_styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <title>Admin – Doctors</title>
</head>
<body>

<header class="navbar-admin">
    <div class="logo">
        <a href="{{ url_for('main.index') }}">CuraCloud</a>
    </div>
    <div class="nav-buttons">
        <div class="right-header">
            <div class="profile-icon">
                <img src="{{ url_for('static', filename='images/user.png') }}" alt="Admin Icon">
            </div>
            <a href="{{ url_for('auth.logout') }}">
                <button class="logout-btn">Logout</button>
            </a>
        </div>
    </div>
</header>

<div class="container">

    <!-- Sidebar -->
    <div class="side-menu">
        <ul>
            <li><a href="{{ url_for('admin.admin_home') }}">Home</a></li>
            <li><a href="{{ url_for('admin.admin_patients') }}">Patients</a></li>
            <li><a href="{{ url_for('admin.admin_doctors') }}" class="active">Doctors</a></li>
            <li><a href="{{ url_for('admin.admin_billing') }}">Billing</a></li>
            <li><a href="{{ url_for('admin.admin_appointments') }}">Appointments</a></li>
            <li><a href="{{ url_for('admin.system_logs') }}">System Logs</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="content">

        <div class="welcome-section-admin">
            <div class="welcome-message">Doctor Directory</div>
            <div class="welcome-subtitle">View and manage all registered doctors.</div>
        </div>

        <!-- Add Doctor Button -->
        <div class="add-patient-header">
            <button class="btn-primary-admin" id="openAddDoctorModal">+ Add Doctor</button>
        </div>

        <!-- Doctors Table -->
        <div class="dashboard-container">
            <div class="dashboard-vertical">

                {% if doctors %}
                <div class="table-container">
                    <table class="billing-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Specialty</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Patients</th>
                                <th>Actions</th>
                            </tr>
                        </thead>

                        <tbody>
                        {% for doc in doctors %}
                        <tr>
                            <td>{{ doc.doctor_id }}</td>
                            <td>Dr. {{ doc.first_name }} {{ doc.last_name }}</td>
                            <td>{{ doc.specialty or "N/A" }}</td>
                            <td>{{ doc.email or "N/A" }}</td>
                            <td>{{ doc.phone_number or "N/A" }}</td>
                            <td>{{ doc.patients|length }}</td>

                            <td class="action-cell">

                                <!-- Edit Button -->
                                <button class="icon-btn edit-btn"
                                        title="Edit Doctor"
                                        data-id="{{ doc.doctor_id }}"
                                        data-first="{{ doc.first_name }}"
                                        data-last="{{ doc.last_name }}"
                                        data-email="{{ doc.email }}"
                                        data-phone="{{ doc.phone_number }}"
                                        data-specialty="{{ doc.specialty }}"
                                        data-city="{{ doc.city }}"
                                        data-state="{{ doc.state }}"
                                        data-accept="{{ doc.accepting_patients }}">
                                    <i class="fas fa-pen"></i>
                                </button>


                                <!-- Delete Button -->
                                <form method="POST"
                                    action="{{ url_for('admin.delete_doctor', doctor_id=doc.doctor_id) }}"
                                    onsubmit="return confirm('Delete this doctor?');">

                                    <button type="submit" class="icon-btn delete-btn" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% else %}
                    <p>No doctors found.</p>
                {% endif %}

            </div>
        </div>
    </div>
</div>

<!-- Add Doctor Modal -->
<div id="addDoctorModal" class="modal-overlay">
    <div class="modal-content">
        <h3>Add Doctor</h3>
<div class="modal-header-line"></div>

        <form method="POST" action="{{ url_for('admin.add_doctor') }}">

            <input type="text" name="first_name" placeholder="First Name" required>
            <input type="text" name="last_name" placeholder="Last Name" required>

            <select name="specialty" required>
                <option value="">Select Specialty</option>
                {% for spec in specialties %}
                <option value="{{ spec }}">{{ spec }}</option>
                {% endfor %}
            </select>

            <input type="email" name="email" placeholder="Email" required>
            <input type="text" name="phone" placeholder="Phone">
            <input type="text" name="city" placeholder="City" required>
            <input type="text" name="state" placeholder="State" required>

            <label class="checkbox-label">
                <input type="checkbox" name="accepting_patients">
                Accepting New Patients
            </label>

            <div class="modal-buttons">
                <button type="submit" class="btn-primary-admin">Add</button>
                <button type="button" class="btn-secondary-admin" id="closeAddDoctorModal">Cancel</button>
            </div>

        </form>
    </div>
</div>

<!-- Edit Doctor Modal -->
<div id="editDoctorModal" class="modal-overlay">
    <div class="modal-content">
        <h3>Edit Doctor Information</h3>
<div class="modal-header-line"></div>

        <form id="editDoctorForm" method="POST">
            <input type="text" name="first_name" id="edit-first" required>
            <input type="text" name="last_name" id="edit-last" required>
            <input type="email" name="email" id="edit-email" required>
            <input type="text" name="phone" id="edit-phone">

            <select name="specialty" id="edit-specialty" required>
                {% for spec in specialties %}
                <option value="{{ spec }}">{{ spec }}</option>
                {% endfor %}
            </select>

            <input type="text" name="city" id="edit-city" required>
            <input type="text" name="state" id="edit-state" required>

            <label class="checkbox-label">
                <input type="checkbox" name="accepting_patients" id="edit-accept">
                Accepting New Patients
            </label>

            <div class="modal-buttons">
                <button type="submit" class="btn-primary-admin">Save</button>
                <button type="button" class="btn-secondary-admin" id="closeEditDoctorModal">Cancel</button>
            </div>
        </form>

    </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {

    // ADD Doctor Modal
    const addModal = document.getElementById("addDoctorModal");
    const openAddBtn = document.getElementById("openAddDoctorModal");
    const closeAddBtn = document.getElementById("closeAddDoctorModal");

    openAddBtn.onclick = () => addModal.style.display = "flex";
    closeAddBtn.onclick = () => addModal.style.display = "none";

    // EDIT Doctor Modal
    const editModal = document.getElementById("editDoctorModal");
    const closeEditBtn = document.getElementById("closeEditDoctorModal");
    const editForm = document.getElementById("editDoctorForm");

    document.querySelectorAll(".edit-btn").forEach(button => {
        button.addEventListener("click", () => {

            // Fill modal fields
            document.getElementById("edit-first").value = button.dataset.first;
            document.getElementById("edit-last").value = button.dataset.last;
            document.getElementById("edit-email").value = button.dataset.email;
            document.getElementById("edit-phone").value = button.dataset.phone;
            document.getElementById("edit-specialty").value = button.dataset.specialty;
            document.getElementById("edit-city").value = button.dataset.city;
            document.getElementById("edit-state").value = button.dataset.state;

            document.getElementById("edit-accept").checked =
                button.dataset.accept === "True" || button.dataset.accept === "1";

            // Set dynamic POST action
            editForm.action = `/edit_doctor/${button.dataset.id}`;


            editModal.style.display = "flex";
        });
    });

    closeEditBtn.onclick = () => editModal.style.display = "none";

    window.onclick = (e) => {
        if (e.target === addModal) addModal.style.display = "none";
        if (e.target === editModal) editModal.style.display = "none";
    };

});
</script>

<div class="footer">
    <div>© Powered by Coin Flippers</div>
</div>

</body>
</html>
